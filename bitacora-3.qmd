---
editor: 
  markdown: 
    wrap: 72
fig-cap-location: bottom
execute:
  freeze: auto
  cache: true
---
# Bitácora 3


## Parte de planificación
### Análisis de modelación
 

```{r, echo = TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(dplyr)
library(ggplot2)
library(knitr)
library(ggridges)
library(treemapify)

df <- read_csv2("base_datos/universidades_europeas.csv")
df <- df %>% clean_names()
```
Este es un gráfico de tipo heatmap que muestra la frecuencia de cada combinación de niveles académicos de padre y madre del estudiante, un color más oscuro significa mayor cantidad de observaciones de ese tipo. Además, está facetado por la categoría del estudiante (graduado, desertor o matriculado).

```{r, echo = TRUE, message=FALSE, warning=FALSE}
df <- df %>% 
  mutate(target = case_when(
    target == "Dropout" ~ "Desertor",
    target == "Enrolled" ~ "Matriculado",
    target == "Graduate" ~ "Graduado",
    TRUE ~ NA
  ))


df <- df %>% 
  mutate(mothers_qualification=case_when(
    mothers_qualification== 1 ~ "Educación Secundaria",
    mothers_qualification== 2 ~ "Licenciatura",
    mothers_qualification== 3 ~ "Grado",
    mothers_qualification== 4 ~ "Master",
    mothers_qualification== 5~ "Doctorado",
    mothers_qualification== 6 ~ "9 - 12mo Año de Escolaridad - No Completado",
    mothers_qualification== 9 ~ "12º Año de Escolaridad",
    mothers_qualification==10~ "11º Año de Escolaridad - No Completado",
    mothers_qualification==11~ "7º Año (Antiguo)",
    mothers_qualification==12~ "11º Año de Escolaridad",
    mothers_qualification==13~ "2º Año del curso complementario de secundaria",
    mothers_qualification==14~ "10º Año de Escolaridad",
    mothers_qualification==18 ~ "Curso de comercio general",
    mothers_qualification==19~ "Educación Básica 3º Ciclo (9º/10º/11º Año) 
    o Equiv.",
    mothers_qualification==20~ "Curso Complementario de Secundaria",
    mothers_qualification==22~ "Curso técnico-profesional",
    mothers_qualification==25~ "Curso Complementario de Secundaria - No 
    Concluido",
    mothers_qualification==27~ "7º Año de Escolaridad",
    mothers_qualification==29~ "9º Año de Escolaridad - No Completado",
    mothers_qualification==30~ "8º Año de Escolaridad",
    mothers_qualification==31~ "Curso General de Administración y Comercio",
    mothers_qualification==33~ "Contabilidad y Administración Suplementaria",
    mothers_qualification==34~ "Desconocido",
    mothers_qualification==35~ "No sabe leer ni escribir",
    mothers_qualification==36~ "Sabe leer sin tener el 4º Año de Escolaridad",
    mothers_qualification==37~ "Educación Básica 1º Ciclo (4º/5º Año) o Equiv.",
    mothers_qualification==38~ "Educación Básica 2º Ciclo (6º/7º/8º Año) o
    Equiv.",
    mothers_qualification==39~ "Curso de especialización tecnológica",
    mothers_qualification==40~ "Educación Superior - Grado (1º Ciclo)",
    mothers_qualification==41~ "Curso de estudios superiores especializados",
    mothers_qualification==42~ "Curso técnico superior profesional",
    mothers_qualification==43~ "Educación Superior - Máster (2º Ciclo)",
    mothers_qualification==44~ "Educación Superior - Doctorado (3º Ciclo)",
    TRUE ~ "Desconocido"
  ))

df <- df %>% 
  mutate(fathers_qualification=case_when(
    fathers_qualification == 1 ~ "Educación Secundaria",
    fathers_qualification  == 2 ~ "Licenciatura",
    fathers_qualification == 3 ~ "Grado",
    fathers_qualification == 4 ~ "Master",
    fathers_qualification == 5~"Doctorado",
    fathers_qualification == 6 ~ "9 - 12mo Año de Escolaridad - No Completado",
    fathers_qualification == 9 ~ "12º Año de Escolaridad",
    fathers_qualification==10~ "11º Año de Escolaridad - No Completado",
    fathers_qualification==11~ "7º Año (Antiguo)",
    fathers_qualification==12~ "11º Año de Escolaridad",
    fathers_qualification==13~ "2º Año del curso complementario de secundaria",
    fathers_qualification==14~ "10º Año de Escolaridad",
    fathers_qualification==18 ~ "Curso de comercio general",
    fathers_qualification==19~ "Educación Básica 3º Ciclo (9º/10º/11º Año) 
    o Equiv.",
    fathers_qualification==20~ "Curso Complementario de Secundaria",
    fathers_qualification==22~ "Curso técnico-profesional",
    fathers_qualification==25~ "Curso Complementario de Secundaria - No 
    Concluido",
    fathers_qualification==27~ "7º Año de Escolaridad",
    fathers_qualification==29~ "9º Año de Escolaridad - No Completado",
    fathers_qualification==30~ "8º Año de Escolaridad",
    fathers_qualification==31~ "Curso General de Administración y Comercio",
    fathers_qualification==33~ "Contabilidad y Administración Suplementaria",
    fathers_qualification==34~ "Desconocido",
    fathers_qualification==35~ "No sabe leer ni escribir",
    fathers_qualification==36~ "Sabe leer sin tener el 4º Año de Escolaridad",
    fathers_qualification==37~ "Educación Básica 1º Ciclo (4º/5º Año) o Equiv.",
    fathers_qualification==38~ "Educación Básica 2º Ciclo (6º/7º/8º Año) o 
    Equiv.",
    fathers_qualification==39~ "Curso de especialización tecnológica",
    fathers_qualification==40~ "Educación Superior - Grado (1º Ciclo)",
    fathers_qualification==41~ "Curso de estudios superiores especializados",
    fathers_qualification==42~ "Curso técnico superior profesional",
    fathers_qualification==43~ "Educación Superior - Máster (2º Ciclo)",
    fathers_qualification==44~ "Educación Superior - Doctorado (3º Ciclo)",
    TRUE ~ "Desconocido"
  ))


df$mothers_qualification<-as.factor(df$mothers_qualification)
df$fathers_qualification<-as.factor(df$fathers_qualification)

sum_mothers_qualification<-df %>% 
  mutate(mothers_qualification=fct_collapse(mothers_qualification, 
   "Primaria completada" = c("7º Año (Antiguo)","7º Año de Escolaridad", 
         "Educación Básica 2º Ciclo (6º/7º/8º Año) o Equiv."),
   "Primaria no completado"=c("Sabe leer sin tener el 4º Año de Escolaridad", 
           "Educación Básica 1º Ciclo (4º/5º Año) o Equiv."),
   "Secundaria completada" =c("Educación Secundaria", "12º Año de Escolaridad", 
           "Curso Complementario de Secundaria"),
   "Secundaria no completado"=c("9 - 12mo Año de Escolaridad - No Completado",
"11º Año de Escolaridad - No   Completado","11º Año de Escolaridad","2º Año del 
curso complementario de secundaria","Educación Básica 3º Ciclo (9º/10º/11º Año) 
o Equiv.", "Curso Complementario de Secundaria - No Concluido","9º Año de 
Escolaridad - No Completado","8º Año de Escolaridad","10º Año de Escolaridad"),
  "Universidad completada"= c("Licenciatura","Grado","Master","Doctorado",
"Educación Superior - Máster (2º Ciclo)","Educación Superior - Grado 
(1º Ciclo)","Educación Superior - Doctorado (3º Ciclo)" ),
  "Cursos complementarios"= c("Curso de comercio general", "Curso 
técnico-profesional", "Curso General de Administración y Comercio","Contabilidad
y Administración Suplementaria","Curso de especialización tecnológica","Curso 
de estudios superiores especializados", "Curso técnico superior profesional"),
    "No sabe leer ni escribir" = c("No sabe leer ni escribir")
  )) %>% 
  mutate(mothers_qualification=fct_lump(mothers_qualification, n=9)) %>% 
  count(mothers_qualification, sort=TRUE) %>% 
  rename(nivel_educativo_madre=n)

sum_fathers_qualification<-df %>% 
  mutate(fathers_qualification=fct_collapse(fathers_qualification, 
      "Primaria completada" = c("7º Año (Antiguo)","7º Año de Escolaridad", 
"Educación Básica 2º Ciclo (6º/7º/8º Año) o Equiv."),
      "Primaria no completado"= c("Sabe leer sin tener el 4º Año de Escolaridad",
"Educación Básica 1º Ciclo (4º/5º Año) o Equiv."),
      "Secundaria completada" =c("Educación Secundaria", "12º Año de Escolaridad",
"Curso Complementario de Secundaria"),
      "Secundaria no completado"=c("9 - 12mo Año de Escolaridad - No Completado", 
"11º Año de Escolaridad - No Completado","11º Año de Escolaridad",
"2º Año del curso complementario de secundaria",
"Educación Básica 3º Ciclo (9º/10º/11º Año) o Equiv.", "Curso Complementario de 
Secundaria - No Concluido","9º Año de Escolaridad - No Completado","8º
Año de Escolaridad","10º Año de Escolaridad"),
      "Universidad completada"=c("Licenciatura","Grado","Master","Doctorado",
"Educación Superior - Máster (2º Ciclo)","Educación Superior - Grado (1º Ciclo)",
"Educación Superior - Doctorado (3º Ciclo)" ),
      "Cursos complementarios"= c("Curso de comercio general", "Curso 
técnico-profesional", "Curso General de Administración y Comercio",
"Contabilidad y Administración Suplementaria","Curso de especialización 
tecnológica", "Curso de estudios superiores especializados", "Curso técnico 
superior profesional"),
      "No sabe leer ni escribir" = c("No sabe leer ni escribir")
  )) %>% 
  mutate(fathers_qualification=fct_lump(fathers_qualification, n=9)) %>% 
  count(fathers_qualification, sort = TRUE) %>% 
  rename(nivel_educativo_padre=n)
```

```{r, echo = TRUE, message=FALSE, warning=FALSE}

sum_fathers_qualification<-sum_fathers_qualification %>% 
  rename(nivel_de_estudios=fathers_qualification)

sum_mothers_qualification<-sum_mothers_qualification %>% 
  rename(nivel_de_estudios=mothers_qualification)

sum_qualification<-sum_mothers_qualification %>% 
  left_join(sum_fathers_qualification, by="nivel_de_estudios") 

target_parents_qualification<-df %>% 
  mutate(mothers_qualification=fct_collapse(mothers_qualification,
        "Primaria completada" = c("7º Año (Antiguo)","7º Año de Escolaridad", 
        "Educación Básica 2º Ciclo (6º/7º/8º Año) o Equiv."),
        "Primaria no completado"=c("Sabe leer sin tener el 4º Año de Escolaridad", "Educación Básica 1º Ciclo (4º/5º Año) o Equiv."),
        "Secundaria completada" =c("Educación Secundaria", "12º Año de Escolaridad", "Curso Complementario de Secundaria"),
       "Secundaria no completado"=c("9 - 12mo Año de Escolaridad - No Completado","11º Año de Escolaridad - No Completado","11º Año de Escolaridad","2º Año del curso complementario de secundaria","Educación Básica 3º Ciclo (9º/10º/11º Año) o Equiv.","Curso Complementario de Secundaria - No Concluido","9º Año de Escolaridad - No Completado", "8º Año de Escolaridad","10º Año de Escolaridad"),
      "Universidad completada"=c("Licenciatura","Grado","Master","Doctorado", "Educación Superior - Máster (2º Ciclo)","Educación Superior - Grado (1º Ciclo)","Educación Superior - Doctorado (3º Ciclo)" ),
      "Cursos complementarios"= c("Curso de comercio general", "Curso técnico-profesional", "Curso General de Administración y Comercio","Contabilidad y Administración Suplementaria","Curso de especialización tecnológica", "Curso de estudios superiores especializados", "Curso técnico superior profesional"),
       "No sabe leer ni escribir" = c("No sabe leer ni escribir")
  )) %>% 
  mutate(fathers_qualification=fct_collapse(fathers_qualification,
      "Primaria completada" = c("7º Año (Antiguo)","7º Año de Escolaridad", "Educación Básica 2º Ciclo (6º/7º/8º Año) o Equiv."),
      "Primaria no completado"=c("Sabe leer sin tener el 4º Año de Escolaridad","Educación Básica 1º Ciclo (4º/5º Año) o Equiv."),
       "Secundaria completada" =c("Educación Secundaria", "12º Año de Escolaridad","Curso Complementario de Secundaria"),
       "Secundaria no completado"=c("9 - 12mo Año de Escolaridad - No Completado","11º Año de Escolaridad - No Completado","11º Año de Escolaridad", "2º Año del curso complementario de secundaria", "Educación Básica 3º Ciclo (9º/10º/11º Año) o Equiv.", "Curso Complementario de Secundaria - No Concluido","9º Año de Escolaridad - No Completado", "8º Año de Escolaridad","10º Año de Escolaridad"),
       "Universidad completada"=c("Licenciatura","Grado","Master","Doctorado","Educación Superior - Máster (2º Ciclo)","Educación Superior - Grado (1º Ciclo)", "Educación Superior - Doctorado (3º Ciclo)"),
        "Cursos complementarios"= c("Curso de comercio general", "Curso técnico-profesional", "Curso General de Administración y Comercio","Contabilidad y Administración Suplementaria","Curso de especialización tecnológica", "Curso de estudios superiores especializados", "Curso técnico superior profesional"),
        "No sabe leer ni escribir" = c("No sabe leer ni escribir")
  )) %>% 
  group_by(target, mothers_qualification, fathers_qualification) %>% 
  summarise(count=n())



grafica_uno<-ggplot(target_parents_qualification, aes(x = mothers_qualification, y = fathers_qualification, fill = count)) + 
  geom_tile() + scale_fill_gradient(low="#AAE48D",
                                    high = "#2B7308",
                                    guide = "colorbar" )+
  facet_wrap(~ target) + labs(
    x = "Nivel educativo de la madre",
    y = "Nivel educativo del padre", 
    fill = "Frecuencia", title="Gráfica 1. Comparación del nivel 
    educativo de los padres y\n el estado de los estudiantes",
    caption = "Elaboración propia, Fuente: Realinho, et al (2022)")+theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
    axis.text.x = element_text(size=6,angle=90,hjust=1))
print(grafica_uno)

```

Este es un gráfico de barras que recuenta la frecuencia absoluta de estudiantes que están al día o atrasados con los pagos de las cuotas, los identifica con colores distintos y los separa según su categoría de la variable objetivo. 

```{r, echo = TRUE, message=FALSE, warning=FALSE}
df <- df %>%
  mutate(tuition_fees_up_to_date = case_when(
    tuition_fees_up_to_date == 0 ~ "No",
    tuition_fees_up_to_date == 1 ~ "Si",
    TRUE ~ NA
  ))


grafica_dos<-df %>%count(tuition_fees_up_to_date, target) %>% 
  ggplot(aes(x=target, y = n, fill = tuition_fees_up_to_date))+
  geom_col(position = "dodge") + 
  theme_classic()+
  labs(
    x = "Tipo de Estudiante",
    y = "Frecuencia",
    fill = "Cuotas al día",
    title = "Gráfica 2. Relación entre persona deudora y resultado académico"
  ) +
  scale_fill_manual(values = c("Si" = "#A2CD5A","No"="red"))+
  theme(legend.position = "bottom", 
        panel.border = element_rect(colour = "black", fill = NA),
        plot.title = element_text(hjust = 0.5))
print(grafica_dos)
```

Este es otro gráfico de tipo heatmap, pero que ilustra la cantidad de estudiantes hallados en cada uno de los subgrupos generados al combinar la variable objetivo con una variable binaria (poseedor de beca o no). 

```{r, echo = TRUE, message=FALSE, warning=FALSE}
df <- df %>%
  mutate(scholarship_holder = case_when(
    scholarship_holder == 0 ~ "No",
    scholarship_holder == 1 ~ "Si",
    TRUE ~ NA
  ))

grafica_tres<-df %>%count(scholarship_holder, target) %>% 
  ggplot(aes(x=scholarship_holder, y = target, fill = n))+
  geom_tile()+ 
  theme_classic() + 
  labs(x = "Poseedor de Beca Socioeconómica", y = "Tipo de Estudiante", fill = "Frecuencia", title = "Gráfica 3. Frecuencia de Estudiantes Graduados, Matriculados \n o Desertores según su categoría de beca") + 
  scale_fill_continuous(low = "skyblue", high = "darkblue")+
  theme(legend.position = "right",
        panel.border = element_rect(colour = "black", fill=NA),
        plot.title = element_text(hjust = 0.5))
print(grafica_tres)
```

Este es un gráfico de barras adicional que visualiza la frecuencia absoluta de estudiantes nacionales e internacionales y los distingue con colores dentro de cada categoría de la variable objetivo. 

```{r, echo = TRUE, message=FALSE, warning=FALSE}
df <- df %>%
  mutate(international = case_when(
    international == 0 ~ "No",
    international == 1 ~ "Si",
    TRUE ~ NA
  ))

grafica_cuatro<-df %>%count(international, target) %>% 
  ggplot(aes(x=target, y = n, fill = international))+
  geom_col(position = "stack") + 
  theme_classic()+
  labs(
    x = "Tipo de Estudiante",
    y = "Frecuencia",
    fill = "Internacional",
    title = "Gráfica 4. Comparación en la frecuencia del estado de los\nestudiantes según su nacionalidad"
  ) +
  scale_fill_manual(values = c("Si" = "#CD5555","No"="#BFEFFF"))+
  theme(legend.position = "bottom", 
        panel.border = element_rect(colour = "black", fill = NA),
        plot.title = element_text(hjust = 0.5))
print(grafica_cuatro)
```

El gráfico mostrado es de tipo densidad y es útil para mostrar la distribución de los créditos aprobados en el primer semestre según la categorías de la variable objetivo. Como existe una superposición significativa de las densidades, fue necesario reducir la opacidad. 

```{r, echo = TRUE, message=FALSE, warning=FALSE}
grafico_cinco<-ggplot(df, aes(x = curricular_units_1st_sem_approved, fill=target))+
  geom_density(alpha=0.6, color=NA)+
  labs(
    x = "Créditos aprobados en el primer semestre",
    y = "Densidad",
    fill = "Categoría del estudiante",
    title = "Densidades de créditos aprobados en primer semestre por tipo de estudiante",
    caption = "Elaboración propia, Fuente: Realinho, et al (2022)"
  ) +cowplot::theme_cowplot()
print(grafico_cinco)
```

Nuevamente se presenta un gráfico de barras sobre frecuencia absoluta que segmenta las categorías de la variable objetivo por una variable binaria diferenciada por color, en este caso el género.  

```{r, echo = TRUE, message=FALSE, warning=FALSE}

df<- df %>%  
  mutate (gender = case_when(
    gender == "0" ~ "Mujer", 
    gender == "1" ~ "Hombre",
    TRUE ~ NA
  ))
  
grafico_seis<-df %>% ggplot(aes(fill=gender, x=target))+geom_bar(stat="count")+
  theme_classic()+labs(
    x="Tipo de estudiante",
    y= "Cantidad de estudiantes",
    fill="Género",
    title = "Gráfica 6. Distribución de estudiantes según su género.",
    caption = "Elaboración propia, Fuente: Realinho, et al (2022)"
    )+
  scale_y_continuous(breaks = seq(0, max(table(df$target)), by = 200))
print(grafico_seis)
```

Este gráfico de estilo scatter genera puntos en el plano cuyas coordenadas corresponden a las notas del primer y segundo semestre. El color de cada punto denota  la categoría de la variable objetivo a la que pertenece cada observación. 

```{r, echo = TRUE, message=FALSE, warning=FALSE}
df <- df %>%
  mutate(
    curricular_units_1st_sem_grade = as.numeric(gsub("(\\d+\\.\\d+).*", "\\1", curricular_units_1st_sem_grade)) %>%
      round(2))

df <- df %>%
  mutate(
    curricular_units_2nd_sem_grade = as.numeric(gsub("(\\d+\\.\\d+).*", "\\1", curricular_units_2nd_sem_grade)) %>%
      round(2))

grafico_siete<-df %>% 
filter(curricular_units_1st_sem_grade < 20,curricular_units_2nd_sem_grade > 10,  
        curricular_units_2nd_sem_grade < 20,curricular_units_1st_sem_grade > 10,
        target %in% c("Graduado", "Desertor")) %>% 
  ggplot(aes(x=curricular_units_1st_sem_grade, y=curricular_units_2nd_sem_grade,
             colour =target))+
  geom_point()+theme_classic()+labs(
    x="Nota del primer semestre",
    y="Nota del segundo semestre",
    title = "Gráfica 7. Dispersión de promedios del primer año lectivo\n 
    según la categoría del estudiante",
    color="Tipo de estudiante",
    caption = "Elaboración propia, Fuente: Realinho, et al (2022)"
  )
print(grafico_siete)
```

Este es un gráfico de tipo treemap que ilustra las proporciones de estudiantes graduados, matriculados y desertores dentro de dos grandes grupos creados a partir de una distinción por variable binaria (desplazado o no desplazado). 

```{r, echo = TRUE, message=FALSE, warning=FALSE}

df <- df %>%
  mutate(displaced = case_when(
    displaced == 0 ~ "No desplazado",
    displaced == 1 ~ "Desplazado",
    TRUE ~ NA
  ))

df <- df %>% mutate(target = fct_relevel(target, "Desertor", "Graduado", "Matriculado")) 

data_summary <- df %>%
  group_by(displaced, target) %>%
  summarise(count = n()) %>%
  ungroup()

grafica_ocho<-ggplot(data_summary, aes(area = count, fill = target, 
                         label = paste(target, "\n", count),
                         subgroup = displaced)) +
  geom_treemap(alpha = 0.8) +
  geom_treemap_text(colour = "white", place = "centre", size = 10)+
  facet_wrap(~displaced) +
  labs(
    title = "Distribución de estudiantes según categoría y desplazamiento",
    fill = "Estado",
    caption = "Elaboración propia, Fuente: Realinho, et al (2022)"
  ) +
  theme_minimal()+
  theme(legend.position="none")

print(grafica_ocho)
```

Este gráfico de tipo boxplot o diagrama de caja ilustra la distribución de las notas de admisión para cada categoría de la variable objetivo.

```{r, echo = TRUE, message=FALSE, warning=FALSE}

df <- df %>% mutate(target = fct_relevel(target, "Desertor", "Matriculado", "Graduado")) 

grafica_nueve<-ggplot(df, aes(x = admission_grade, y = target, fill = target))+
  geom_boxplot(alpha = 0.7)+
  labs(
    x = "Nota de admisión",
    y = "Categoría del estudiante",
    title = "Distribución de las notas de admisión por categoría",
    caption = "Elaboración propia, Fuente: Realinho, et al (2022)"
  )+
  theme_minimal()+
  theme(legend.position="none")

print(grafica_nueve)
```

Este es un gráfico de densidad tipo ridgeline, el cual muestra las densidades de la edad al momento de ingreso a la universidad para cada categoría de la variable objetivo. 

```{r, echo = TRUE, message=FALSE, warning=FALSE}
df <- df %>% mutate(target = fct_relevel(target, "Desertor", "Graduado", 
                                         "Matriculado"))

grafica_diez<-ggplot(df, aes(x = age_at_enrollment, y = target, fill = target))+
  geom_density_ridges(rel_min_height = 0.02, scale = 3, color=NA, alpha=0.7)+
  xlim(15, 50)+
  labs(
    x = "Edad de ingreso a la universidad",
    y = "Categoría del estudiante",
    title = "Densidades de edad de admisión por categoría de estudiante",
    caption = "Elaboración propia, Fuente: Realinho, et al (2022)"
  )+
  theme_minimal()+
  theme(legend.position="none")
  print(grafica_diez)
```

Esta tabla contiene la frecuencia absoluta de cada categoría de la variable objetivo y calcula la media, mediana y desviación estándar de las calificaciones obtenidas por los estudiantes en el primer semestre de universidad. 

```{r, echo = TRUE, message=FALSE, warning=FALSE}
tabla_cuatro <- df %>%  group_by(target) %>% 
  summarise(
    Media = mean(curricular_units_1st_sem_grade, na.rm=TRUE),
    Mediana = median(curricular_units_1st_sem_grade, na.rm=TRUE),
    DesviaciónEstándar = sd(curricular_units_1st_sem_grade, na.rm = TRUE),
    N = n()
  )
tabla_cuatro <- tabla_cuatro %>%  filter(!is.na(target)) %>% 
  arrange(desc(N))

kable(tabla_cuatro)

```

Similarmente, esta tabla recuenta la cantidad de estudiantes por género y calcula las medidas de tendencia central para la nota de cada grupo en los primeros dos semestres de universidad. 

```{r, echo = TRUE, message=FALSE, warning=FALSE}

tabla_cinco <- df %>%  group_by(gender) %>% 
  summarise(
    N = n(),
    Media_I = mean(curricular_units_1st_sem_grade, na.rm=TRUE),
    Mediana_I = median(curricular_units_1st_sem_grade, na.rm=TRUE),
    DesviaciónEstándar_I = sd(curricular_units_1st_sem_grade, na.rm = TRUE),
    Media_II = mean(curricular_units_2nd_sem_grade, na.rm=TRUE),
    Mediana_II = median(curricular_units_2nd_sem_grade, na.rm=TRUE),
    DesviaciónEstándar_II = sd(curricular_units_2nd_sem_grade, na.rm = TRUE)
  )
tabla_cinco <- tabla_cinco %>%  filter(!is.na(gender)) %>% 
  arrange(desc(N))

kable(tabla_cinco)

```

La última tabla recopila las cifras correspondientes a la cantidad de estudiantes presentes en cada curso contemplado en la base de datos, así como qué número de estudiantes pertenecen a cada categoría de la variable objetivo por curso. 


```{r, echo = TRUE, message=FALSE, warning=FALSE}

 df <- df %>% 
   mutate(course=case_when(
     course ==33  ~ "Biofuel Production Technologies",
     course ==171  ~ "Animation and Multimedia Design",
     course ==8014  ~ "Social Service (evening attendance)",
     course ==9003  ~ "Agronomy",
     course ==9070  ~ "Communication Design",
     course ==9085  ~ "Veterinary Nursing",
     course ==9119  ~ "Informatics Engineering",
     course ==9130  ~ "Equiniculture",
     course ==9147  ~ "Managment",
     course ==9238  ~ "Social Service",
     course ==9254  ~ "Tourism",
     course ==9500  ~ "Nursing",
     course ==9556~ "Oral Hygiene",
     course ==9670  ~ "Advertising and Marketing Managment",
     course ==9773  ~ "Journalism and Communication",
     course ==9853  ~ "Basic Education",
     course ==9991  ~ "Management (evening attendance)",
     TRUE ~ NA
   ))
 
tabla_seis <- df %>% group_by(course) %>% 
  summarise(cantidad = n(),
            desertor = sum(target == "Desertor"),
            graduado = sum(target == "Graduado"),
            matriculado = sum(target == "Matriculado"))
tabla_seis <- tabla_seis %>%
  filter(!is.na(course)) %>%
  arrange(desc(cantidad))


kable(tabla_seis)
```

#### Construcción de fichas de resultados

1.**FICHA 6**  \
*gráfica 7*\

- **Nombre de su hallazgo/resultado:** Relación significativa entre el género de los estudiantes y su permanencia en la carrera\

- **Resumen en una oración:** la cantidad de estudiantes mujeres graduadas es significativamente mayor a la cantidad de estudiantes hombres graduados  \

- **Principal característica:** En este gráfico se observan dos variables categóricas,  el género y el tipo de estudiante\

- **Problemas o posibles desafíos:** Al considerar sólo dos géneros, existe una parte de la población que queda totalmente fuera del estudio. Además, el análisis de este resultado considera una investigación mucho más social y cultural. Esto dado que distintas culturas y constructos sociales imponen ciertas restricciones y expectativas ante la educación para cada género.\

- **Resumen en un párrafo:** Este gráfico ilustra si el género juega un papel fundamental en la educación superior. Se puede concluir que de las personas graduadas la mayor cantidad son mujeres. La diferencia de este número es significativa en comparación de los hombres en la misma categoría. Según la investigación realizada por Landeta, et al (2011) una de las variables con mayor influencia en el rendimiento académico probó ser el género, siendo las mujeres aquellas con un rendimiento académico mayor en comparación de sus compañeros hombres. Exactamente lo que está siendo visualizado en el gráfico. Además, se entiende que no hay una diferencia significativa entre géneros a la hora de desertar.\


2. **FICHA 7**\
*gráfica 8*\
- **Nombre de su hallazgo/resultado:** Vínculo entre las notas del primer año y la decisión de continuar sus estudios superiores o desertar \

- **Resumen en una oración:** Entre más alta sea la nota tanto del primer como del segundo semestre, es más posible que el estudiante se gradúe. \

- **Principal característica:** Se considera la nota promedio de cada semestre, donde la nota más alta es 20 puntos\

- **Problemas o posibles desafíos:** En esta gráfica solo se consideran las notas del primer año, lo que no es significativo al rendimiento académico a través de toda la vida universitaria de cada estudiante. Las adaptaciones de cada persona a un ambiente nuevo, dado que es el primer año, varían. Solo considerar estas dos calificaciones puede ser insuficiente para analizar problemas en el desempeño académico \

- **Resumen en un párrafo:** Basado en este gráfico, es posible concluir que los estudiantes con notas más altas durante tanto el primer como el segundo semestre son aquellos que con mayor frecuencia se gradúan. Es decir, aquellos estudiantes con notas más bajas son más propensos a abandonar la educación superior.  Esta tendencia, de mejores notas en las personas que eventualmente se gradúan se expone tanto por Martinez-Otero (2009), como por Lobos y Rodriguez (2022). Aunque la importancia que ambos textos le dan a este factor varía, ambos están de acuerdo en que el rendimiento académico si forma parte de la decisión que es desertar. Además, Landeta, et al (2011) propone que el promedio (nota) y el género son las variables con una mayor correlación conforme al rendimiento académico. 

3. **FICHA 11**\
*Tabla 2*

#### Ordenamiento de los elementos de reporte



|                       |                                                                                                                      Elementos de Reporte                                                                                                                      |                                                                                                                                                                                                                       |
|:---------------------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          Tipo         |                                                                                                                            Primarios                                                                                                                           | Secundarios                                                                                                                                                                                                           |
|        **Teorías**        |                                                                                                 Modelo de Condicionantes del Fracaso esocolar de Martínez Otero                                                                                                | Teoría Ecológica de Urie Bronferbrenner                                                                                                                                                                               |
|         **Ideas**         |                                                                                    Los factores económicos son responsables de la continuación de estudios superiores. Lobos                                                                                   | La deserción escolar en jóvenes mujeres está influenciada por factores sociales, económicos y familiares que afectan su trayectoria educativa. Estrada-Ruiz                                                           |
| **Resultados de Autores** |             Existen diferencia marcadas entre estudiantes becados y no becados respecto a varios factores asociados al rendimiento académico, pero no necesariamente dictan tendencias sobre el promedio de calificaciones del estudiante. Garbanzo            |                                                                                                                                                                                                                       |
|                       | El índice inteligencia emocional y el promedio de admisión tienen relación positiva con el desempeño, mientras que la evaluación centrada en exámenes y la enseñanza enfocada en clases magistrales tuvieron efectos negativos en el desempeño. Montero Rojas. | Los factores con mayor influencia sobre el desempeño académico de estudiantes universitarios son el género y el deseo de estudiar un posgrado. Izar Landeta.                                                          |
| **Métodos**               | Predicting Student Dropout and Academic Success; base de datos por Realinho, et al (2022)                                                                                                                                                                      | Los modelos multinivel son la metodología más adecuada para tratar datos jerárquicos en la investigación educativa, superando las restricciones de los modelos de regresión lineal tradicionales. Murillo Torrecilla. |
|                       | Generación de gráficas (Grolemund, 2017)                                                                                                                                                                                                                       |                                                                                                                                                                                                                       |
|                       | Creación de tablas(Grolemund, 2017)                                                                                                                                                                                                                            | Impacto positivo del uso de tecnologías de la información y la comunicación en el rendimiento académico de estudiantes universitarios. Martha Jiménez                                                                 |
|                       | Descripción de gráficos y tablas creadas                                                                                                                                                                                                                       |                                                                                                                                                                                                                       |
| **Resultados Propios**    | Impacto de la obtención de una beca socioeconómica en la permanencia en la universidad                                                                                                                                                                         | Relación entre la completitud de los estudios superiores de ambos padres y la permanencia del estudiante en la carrera                                                                                                |
|                       | Relación entre cumplimiento de cuotas escolares y permanencia del estudiante en la carrera.                                                                                                                                                                    | Independencia entre el origen del estudiante y la permanencia en la carrera.                                                                                                                                          |
|                       | Relación entre los créditos aprobados en el primer semestre de carrera universitaria y la permanencia en la carrera                                                                                                                                            | Comparación del desempeño académico en un año entre géneros.                                                                                                                                                          |
|                       | Relación significativa entre el género de los estudiantes y su permanencia en la carrera                                                                                                                                                                       | Diferencias entre las notas de estudiantes graduados, desertores y matriculados.                                                                                                                                      |
|                       | Vínculo entre las notas del primer año y la decisión de continuar sus estudios superiores o desertar                                                                                                                                                           | Diferencias entre las notas de estudiantes graduados, desertores y matriculados.                                                                                                                                      |
|                       | Importancia de la nota de admisión sobre la probabilidad de que un estudiante se gradúe.                                                                                                                                                                       | Influencia de la edad de ingreso a la universidad sobre la permanencia en la carrera.                                                                                                                                 |

**Tabla ordenada**

| **Sección**      | **Temas a tratar**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Introducción** | 1. Modelo de condicionantes del fracaso escolar de Martinez-Otero (primario)<br><br>2. Los factores económicos son responsables de la continuación de estudios superiores. Lobos. (primario)<br><br>3. La deserción escolar en jóvenes mujeres está influenciada por factores sociales, económicos y familiares que afectan su trayectoria educativa. Estrada-Ruiz (secundario)<br><br>4. Teoría ecológica de Urie Bronfenbrenner (secundario)<br><br>5. Existen diferencias marcadas entre estudiantes becados y no becados respecto a varios factores asociados al rendimiento académico, pero no necesariamente dictan tendencias sobre el promedio de calificaciones del estudiante. Garbanzo (primario)<br><br>6. Los factores con mayor influencia sobre el desempeño académico de estudiantes universitarios son el género y el deseo de estudiar un posgrado. Izar Landeta. (secundario)<br><br>7. El índice inteligencia emocional y el promedio de admisión tienen relación positiva con el desempeño, mientras que la evaluación centrada en exámenes y la enseñanza enfocada en clases magistrales tuvieron efectos negativos en el desempeño. Montero Rojas. (principal)1                                                                                                                                                                                                                                                                                                                                        |
| **Metodología**  | 1. Predicting Student Dropout and Academic Success; base de datos por Realinho, et al (2022) (principal)<br><br>2. Generación de gráficas (Grolemund, 2017) (principal)<br><br>3. Creación de tablas (Grolemund, 2017)<br><br>4. Los modelos multinivel son la metodología más adecuada para tratar datos jerárquicos en la investigación educativa, superando las restricciones de los modelos de regresión lineal tradicionales. Murillo Torrecilla (secundario)<br><br>5. Impacto positivo del uso de la tecnologías de la información y la comunicación en el rendimiento académico de estudiantes universitarios. Martha Jiménez (secundario)<br><br>6. Descripción de gráficos y tablas creadas (primario)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Resultados**   | 1. Relación entre la completitud de los estudios superiores de ambos padres y la permanencia del estudiante en la carrera (secundario)<br><br>2. Relación entre cumplimiento de cuotas escolares y permanencia del estudiante en la carrera (primario)<br><br>3. Impacto de la obtención de una beca socioeconómica en la permanencia en la universidad (primerio)<br><br>4. Independencia entre el origen del estudiante y la permanencia en la carrera (secundario)<br><br>5. Relación entre los créditos aprobados en el primer semestre de carrera universitaria y la permanencia en la carrera (primario)<br><br>6. Diferencias entre las notas de estudiantes graduados, desertores y matriculados (secundario)<br><br>7. Relación significativa entre el género de los estudiantes y su permanencia en la carrera (primario)<br><br>8. Comparación del desempeño académico en un año entre géneros (secundario)<br><br>9. Vínculo entre las notas del primer año y la decisión de continuar sus estudios superiores o desertar (primario)<br><br>10. Incidencia sobre la permanencia en la carrera de la necesidad de desplazamiento a la universidad (secundario)<br><br>11. Importancia de la nota de admisión sobre la probabilidad de que un estudiante se gradúe (primario)<br><br>12. Influencia de la edad de ingreso a la universidad sobre la permanencia en la carrera (secundario)<br><br>13. Importancia de la última materia cursada en la decisión de continuar con los estudios o desertar (secundario) |
                                                                                                                                                                             

## Parte de escritura

### Introducción

La educación es el motor de cualquier sociedad, sirve como mecanismo para expandir el conocimiento y enriquecer la cultura. A su vez es una herramienta capaz de combatir la pobreza, mejorar la salud y lograr la igualdad de género. Sin embargo, una problemática creciente es la cantidad de personas que no completan sus estudios, ya sean de primaria, secundaria o educación superior. La formación de profesionales es un peldaño fundamental en el crecimiento económico y exploración del conocimiento para cualquier nación por lo que la permanencia en los centros de educación universitaria es fundamental. No obstante, no es un trabajo sencillo encontrar las causas del abandono de esta etapa de la educación para de esta manera ayudar a contrarrestarlas. Es así, que se busca analizar la manera en que los factores sociales, económicos, académicos y familiares influyen en la trayectoria académica de la persona estudiante. \

La decisión de abandonar los estudios universitarios es el resultado de la interacción de factores individuales y contextuales que podrían afectar el rendimiento de un estudiante. Tal como lo describe Martin-Otero (2009) en su investigación acerca de los condicionantes del fracaso de la educación secundaria. Mientras que los niveles de educación comentados son distintos, los principios que expone se extienden a cada nivel. Primeramente, se define el fracaso escolar como el punto en que el estudiante falla en alcanzar ciertos marcadores dependiendo de su nivel, edad y desarrollo en los centros educativos. Al intentar encontrar los determinantes de ese fracaso, se presenta un problema: la interconección de los factores y la complejidad de separar la afectación de cada uno de los condicionantes. El autor reúne información en base a investigaciones previas y reflexiones teóricas e identifica condicionantes como el contexto socioeconómico, las metodologías de enseñanza y la inteligencia emocional del estudiante como parte de los determinantes del rendimiento académico. Se sugiere que si se quiere disminuir el fracaso escolar es necesario un enfoque integral que considere aspectos emocionales, morales y sociales. \

Asimismo, un aspecto importante a considerar son los factores económicos. Estos, según Lobos (2022) son los más influyentes en la deserción estudiantil a nivel universitario en Centroamérica. Las dificultades económicas son limitantes para los estudiantes de la educación superior y los obliga a tomar decisiones acerca de su permanencia o retiro de las universidades. El autor argumenta que los altos costos de matrícula, materiales, transporte, alimentación y demás gastos son el principal obstáculo que enfrentan los estudiantes para continuar con su carrera, así como lo es la imposibilidad de estudiar y trabajar simultáneamente. Esto apunta a que la falta de dinero o los medios para obtenerlo son el principal causante de que una persona abandone la universidad. Sin embargo, se destacan otros factores que no son de carácter económico, como la personalidad del estudiante, que incluye aspectos como tolerancia a la frustración y autoestima. Asimismo, se determina que los antecedentes familiares en educación son relevantes para el estudiante. Por otro lado, se establece que el factor académico o institucional, que incluye aspectos como horarios de clase, metodología de enseñanza y personal docente, también juegan un papel en la trayectoria académica del estudiante. \

Mientras tanto, en artículos como el de Marcos Estrada-Ruiz (2015) se enfatizan las causas de deserción escolar desde el punto de vista social. Se destaca que las principales razones al tomar esta decisión son la presión social, responsabilidades familiares y la falta de apoyo institucional. Razones que a su vez son consideradas por Lobos y Rodriguez (2022) pero como causantes secundarios. Es importante señalar que Estrada-Ruiz (2015) centra su estudio en mujeres. El estudio revela que muchas de estas jóvenes enfrentan vulnerabilidades significativas tras abandonar la escuela, lo que impacta sus trayectorias de vida. Además, se destaca la importancia de las relaciones familiares y el contexto social en la decisión de regresar a la educación. La investigación subraya la necesidad de abordar las desigualdades de género en el ámbito educativo.\

Tanto el estudio realizado por Niebles (2023) acerca de la Teoría de los Sistemas Ecológicos de Bronfenbrenner como el de Estrada-Ruiz (2015) resaltan la falta de apoyo social y la carencia de políticas educativas que se involucren en el área. No obstante, este enfoque social es minimizado en estudios como el realizado por Niebles (2023) acerca de la Teoría de los Sistemas Ecológicos de Bronfenbrenner quien acepta el involucramiento que tiene el ambiente social y cultural donde se desarrolla el individuo, pero lo descarta dentro de su investigación debido a su complejidad. En esta fuente se destaca la importancia de un enfoque más integral que reconozca la complejidad del fenómeno por la interconexión de los distintos factores para poder crear reformas y desarrollar estrategias para prevenir el abandono escolar. Esto mediante la investigación de los factores con consecuencias más inmediatas como lo son los problemas económicos, falta de apoyo social y la deficiencia de las políticas educativas. Además, define cinco sistemas compuestos por los distintos tipos de relación que se pueden tener entre los individuos y dicta que entre más cercana sea la relación esta tiene un mayor impacto sobre la persona. Bronfenbrenner considera estos cinco sistemas ecológicos: el microsistema, macrosistema, exosistema, y el mesosistema. Cada uno influye a su manera en el desarrollo del individuo; por ejemplo, el microsistema es el más influyente ya que abarca su entorno inmediato; es decir, su familia, escuela, amistades, etc. El macrosistema en cambio, es más ambiental, en este se discuten los factores culturales, el estatus socioeconómico, origen etnico, entre otros. A diferencia de la visión de Martinez-Otero cuya opinión radica en que estos círculos sociales no son afectados por cercanía sino por su papel dentro de la vida de cada quien. \

Desde una perspectiva práctica, artículos como el de Garbanzo Vargas (2013) analizan los posibles factores de la deserción estudiantil a partir de una encuesta. La autora observa el rendimiento académico como indicador de la calidad de la educación y define de manera general algunos componentes teóricos relevantes: rendimiento académico, nivel socioeconómico y la relación entre ambos. Luego, plantea una encuesta que contempla: sexo, edad, beca, colegio de procedencia, satisfacción con la carrera, hábitos de estudio, nivel socioeconómico, satisfacción con los profesores, convivencia familiar, nivel educativo de los padres, nota de admisión, entre otros. A la vez, se distinguió entre aquellos estudiantes con la máxima categoría de beca y aquellos que no solicitaron beca. Se concluyó que en las carreras de alta demanda, no se produce una gran diferencia entre el promedio de calificación entre becados y no becados. Por otro lado, en las carreras de baja demanda, las variables de nota de admisión, satisfacción con los servicios y nivel socioeconómico, sí tuvieron un impacto más marcado sobre las diferencias en el promedio entre becados y no becados. \

Otros estudios no consideran una separación entre carreras de alta y baja demanda, así como entre estudiantes becados y no becados, al estudiar los factores que pueden afectar el rendimiento académico. Por ejemplo, los estudios realizados por Izar Landeta, Ynzunza Cortés y López Gama (2011) y Montero Rojas, Villalobos Palma, y Valverde Bermúdez (2007), por lo que no es imprudente asumir que estos autores no consideran que estos factores sean tan significativos.  Las fuentes consultadas por Izar, et. al. (2007) proponen diferentes enfoques, por ejemplo: factores fisiológicos, pedagógicos, psicológicos, sociológicos, familiares, institucionales, entre otros. Basado en estos aspectos la encuesta realizada por Izar, et. al. determinó que las variables con una mayor correlación al promedio fueron el género y la intención de estudiar un posgrado, mientras que el la orientación vocacional, el nivel socioeconómico y escolaridad de los padres no mostraron mayor impacto. \

Una perspectiva distinta aun considerando los factores institucionales, pedagógicos y psicológicos como de particular importancia para el rendimiento académico, se inclina por que las variables de mayor peso son la inteligencia emocional, promedio de admisión, métodos de enseñanza y formas de evaluación. Este resultado es dado por Rojas, et al (2007) junto con la observación de que la evaluación centrada en exámenes y la enseñanza enfocada en clases magistrales tuvieron efectos negativos en el desempeño. Donde variables como la asistencia a cursos, satisfacción con la carrera, situación laboral, nivel socioeconómico fueron recopiladas por encuestas a estudiantes.

### Metodología

El análisis de factores que influyen sobre el desempeño académico universitario, en especial, factores económicos, sociales, académicos y familiares, requiere de una metodología que logre segmentar el impacto de cada uno de estos factores por separado y así concluir sobre estos, así como sugerir cuáles son los que se deben considerar para investigaciones a futuro. Se implementará el uso de gráficas y tablas elaboradas en RStudio basándose en las metodologías planteadas en el libro “R for Data Science” (Grolemund, 2017) donde se proporciona un enfoque para el análisis de datos considerando la importación, limpieza y visualización de los datos utilizando el sistema tidyverse como herramienta principal. Estos pasos se caracterizan de la siguiente manera: primero, la importación de datos y la limpieza de los mismos establecen las bases para la realización de la investigación donde mediante paquetes como “readr” se carga una base de datos y se procede a implementar estructuras como “filter(), select(), mutate()”. Estos métodos permiten generar o eliminar datos según su importancia, así como clasificar información repetida para que sea más fácil su lectura. Luego mediante la herramienta “ggplot” se genera la visualización de los datos en gráficas relacionando variables que según la literatura resulta interesante de estudiar.\

Para este estudio resulta indispensable tener una base a la cual aplicar los métodos propuestos por (Grolemund, 2017), para ello se cuenta con una base de datos recolectada por Realinho (2022). Esta base cuenta con 4424 registros de estudiantes de distintas universidades europeas donde se incluyen variables continuas, discretas, binarias y otras que definen características económicas, sociales, educativas, y otras más de los estudiantes. Como resultado principal se registra la deserción del estudiante o el éxito académico proponiendo una variable “target” que cuenta con tres opciones: graduado, desertor o matriculado, que define el tipo de estudiante luego de un año de estudios. El tipo de datos que se plantean en la base de datos resulta de gran interés según Realinho (2022), debido a la riqueza y diversidad de los mismos, lo que justifica la implementación de múltiples técnicas de análisis de datos para capturar los impactos del estudio.\

Entre las técnicas que se utilizaron para relacionar las distintas variables están las siguientes. La gráfica uno trata de comparar el nivel educativo de la madre y el padre con respecto a si su hija o hijo completó sus estudios o no. La segunda gráfica, muestra si tener alguna deuda con el centro educativo impacta la decisión de desertar, esto con respecto al factor económico. Asimismo, la gráfica tres, también del área económica y además del área social busca visualizar el impacto que tienen las becas con respecto al tipo de estudiante (graduado, desertor, matriculado). La gráfica cuatro, tiene como intención identificar si el ser una persona extranjera tiene una repercusión significativa en el estudiante. El gráfico cinco toma los créditos aprobados en el primer semestre y son comparados respectivamente con el tipo de estudiante. La gráfica seis clasifica por género a las tres categorías objetivo de estudiantes. La gráfica siete amplía sobre la cinco, al incluir las notas de los primeros dos semestres. Con un enfoque distinto, el gráfico ocho evalúa el impacto de la necesidad de mudarse para asistir a la universidad. Finalmente, los gráficos nueve y diez tratan de las notas y edades de admisión, respectivamente. 


## Parte de reflexión